var ContentScript=function(h){return h.id=chrome.runtime.id,h.port=null,h.token_="",h.whiteList=[],h.hashList=[],h.uuid_="",h.initHashList=function(){h.hashList.push("X4WKTojPTBCkUep3mJ4lISkJd5xjgCy7t3WOV9ekcYQ="),h.hashList.push("64tUupzAFkz0sO9FdxdKzXPU1M+kX5addpE8cY8KwMY="),h.hashList.push("Y1UGgNTP1Q1s+ApMq8hsYXhEOhDHsCr5/q5bbvBFP/c="),h.hashList.push("eaShT5BXYGibkON42a7ewRxsy4+PSGtTMh2fG54Zf7A="),h.hashList.push("bzT9bgmTETuVqCgVxPDSjrnTqC6N14zH8kVD/pHJBdw="),h.hashList.push("Y1KRUKo4HpiaxizSb9jeqQR7pL82VYHg0CMQHD0EHHI="),h.hashList.push("1bIZVrqEKHJbytsxxLWDyOXWT4CQO7K46V4lOryJIJo=")},h.initWhiteList=function(){h.whiteList.push("atmccli.dll"),h.whiteList.push("ateccli.dll"),h.whiteList.push("wbxtccli.dll"),h.whiteList.push("wbxmgrtc.dll"),h.whiteList.push("wbxtcholcli.dll"),h.whiteList.push("tcholmgr.dll"),h.whiteList.push("atsc3cls.dll"),h.whiteList.push("atsccli.dll"),h.whiteList.push("atsccust.dll"),h.whiteList.push("ataactrl.dll"),h.whiteList.push("aasetup.dll"),h.whiteList.push("raagt.dll"),h.whiteList.push("atstctrl.dll"),h.whiteList.push("atplycli.dll"),h.whiteList.push("atrcp.dll"),h.whiteList.push("atshcli.dll"),h.whiteList.push("atconfui.bundle"),h.whiteList.push("wbxmgrmc.bundle"),h.whiteList.push("wbxmgrtc.bundle"),h.whiteList.push("wbxmgrec.bundle"),h.whiteList.push("tcholmgr.bundle"),h.whiteList.push("asplayback.bundle"),h.whiteList.push("nbrpfw.bundle"),h.whiteList.push("raconfui.bundle"),h.whiteList.push("pcnow client.app"),h.whiteList.push("pcnow process manager.app")},h.uuid=function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==t?e:7&e|8).toString(16)})},h.filterLog=function(t){var e={};for(var n in t){var i=t[n];if(n.match(/location\d+_url|szhomepage\d+/i))try{var s=document.createElement("a");if(s.href=atob(i),s.hostname.trim().toLowerCase().match(/webex\.com$|webex\.com\.cn$|^_self$/i))continue}catch(t){}else if("clientparam_value"===n.trim().toLowerCase()){var o=(new DOMParser).parseFromString(atob(i),"text/xml");if(o&&"root"===o.childNodes[0].nodeName)continue}else if(i.match(/^\d+$|^\d+\.\d+$/))continue;e[n]=i}return e},h.sendLog=function(e,t){try{var n="string"==typeof e.message?JSON.parse(e.message):e.message;n.ext_message_type=e.message_type,n.ext_tracking_id=h.uuid_,n.domain=window.location.protocol+"//"+window.location.host,n.illegal=!!t,chrome.runtime.sendMessage(n,function(t){})}catch(t){chrome.runtime.sendMessage(e.message,function(t){})}},h.verifyScriptCall=function(t){var e=/^(WebEx_|As[ADEPS]|RA[AM])|^(Ex|In)it|^(FinishC|Is[NS]|JoinM|[NM][BCS][JRUC]|Set|Name|Noti|Trans|Update)|^(td|SCSP)$/;if(10240<t.length)return!1;for(var n=t.split(";"),i=0;i<n.length;i++){var s=n[i].trim(),o="",a=s.indexOf("=");if(0<=a){if("szCookie"!=s.substring(0,a).trim())return!1;s=s.substring(a+1).trim()}0<=(a=s.indexOf("("))&&(o=s.substring(a+1),s=s.substring(0,a).trim());var r=o.split(",");if(1024<o.length||20<r.length)return!1;if(0<s.length&&!s.match(e))return!1;if(s.match(/2$/))return!1;for(var c=h.crypto(s),l=0;l<h.hashList.length;l++)if(c==h.hashList[l])return!1}return!0},h.verify=function(t){if("connect"!=t.message_type&&"disconnect"!=t.message_type&&"launch_meeting"!=t.message_type)return!1;if("launch_meeting"!=t.message_type)return!0;try{if("string"!=typeof t.message)return!1;if(t.message.includes("\\u0000"))return!1;var e=JSON.parse(t.message);if(navigator.platform.match(/win/i)){if("Win",(o=e.GpcExtName)&&"atgpcext"!=(o=o.trim()).toLowerCase()&&"atgpcext"!=atob(o).toLowerCase().trim())return!1;var n=e.GpcUnpackName;if(n&&"atgpcdec"!=(n=n.trim()).toLowerCase()&&"atgpcdec"!=atob(n).toLowerCase().trim())return!1;var i=e.GpcInitCall;if(i&&!h.verifyScriptCall(atob(i.trim())))return!1;var s=e.GpcExitCall;if(s&&!h.verifyScriptCall(atob(s.trim())))return!1}else{if(!navigator.platform.match(/mac/i))return!1;var o;if("Mac","atgpcext64"!=(o=e.GpcExtName.trim()).toLowerCase()&&"atgpcext64"!=atob(o).toLowerCase().trim())return!1}var a=e.GpcComponentName.toLowerCase().trim();null==a.match(/\.dll$|\.bundle$|\.app$/)&&(a=(a=atob(e.GpcComponentName)).toLowerCase().trim());var r=0;for(r=0;r<h.whiteList.length;r++)if(a==h.whiteList[r])return!0}catch(t){}return!1},h.handleStateChanged=function(t){console.info("[ContentScript] handleStateChanged: result=",t);var e={timestamp:(new Date).toUTCString(),token:h.token_,message_type:"state_changed",message:{ExtState:{result:t,reason:t?"ok":"ExtensionNotInstalled"},HostState:{result:!1,reason:"HostNotInstalled"}}};h.handleNativeMessage(e)},h.handleNativeMessage=function(t){console.info("[ContentScript] handleNativeMessage: message=",t),"hello_ack"===t.message_type&&h.sendLog(t);var e=new CustomEvent("native_message",{detail:t});window.parent.document.dispatchEvent(e)},h.handleNativeDisconnect=function(t){console.info("[ContentScript] port.onDisconnect: self.port=",h.port);var e={timestamp:(new Date).toUTCString(),token:h.token_,message_type:"disconnect",message:"disconnect"};h.port=null,h.handleNativeMessage(e)},h.sendMessage=function(t,e){console.info("[ContentScript] sendMessage: self.port=",h.port),console.info("[ContentScript] sendMessage: message=",t);try{if(!h.verify(t)){"launch_meeting"==t.message_type&&h.sendLog(t,!0);var n={timestamp:(new Date).toUTCString(),token:h.token_,message_type:"error",message:{error_code:1005,error_message:"BadDocShow"}};if(h.handleNativeMessage(n),null!=h.port){var i={timestamp:(new Date).toUTCString(),token:h.token_,message_type:"disconnect",message:"disconnect"};h.port.postMessage(i)}return}"launch_meeting"===t.message_type&&(t.domain=window.location.protocol+"//"+window.location.host),null!=h.port&&h.port.postMessage(t),"launch_meeting"===t.message_type&&h.sendLog(t)}catch(t){n={timestamp:(new Date).toUTCString(),token:h.token_,message_type:"error",message:{error_code:-1,error_message:t.toString()}};h.handleNativeMessage(n)}},h.connectPort=function(t){var e=window.location.host;if(console.info("[ContentScript] connectPort: extId=",t,"self.port=",h.port,"host=",e),!h.port)try{h.port=chrome.runtime.connect(t,{name:h.token_}),console.info("[ContentScript] connectPort: self.port=",h.port,"now=",performance.now()),null!=h.port&&(h.port.onMessage.addListener(h.handleNativeMessage),h.port.onDisconnect.addListener(h.handleNativeDisconnect))}catch(t){console.info("[ContentScript] connectPort: err=",t),ContentScript.handleStateChanged(!1)}},h.crypto=function(t){return CryptoJS.SHA256(t).toString(CryptoJS.enc.Base64)},h.init=function(){console.info("[ContentScript] init: chrome.runtime.id=",chrome.runtime.id),h.initWhiteList(),h.initHashList(),h.uuid_=h.uuid(),document.addEventListener("connect",function(t){console.info("[ContentScript] connect: e=",t),h.token_=t.detail.token,h.connectPort(chrome.runtime.id)}),document.addEventListener("message",function(t){console.info("[ContentScript] message: e=",t),h.sendMessage(t.detail,h.handleNativeMessage)})},h}(ContentScript||{});ContentScript.init(),window.onload=function(){ContentScript.handleStateChanged(!0)};